<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meridian ESG Database Mastery Course - V2 Pipeline Flow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden;
        }

        .presentation-container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .slide-nav {
            list-style: none;
        }

        .slide-nav-item {
            margin: 8px 0;
            padding: 12px 15px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .slide-nav-item:hover {
            background: rgba(52, 152, 219, 0.2);
            transform: translateX(5px);
            border-left-color: #3498db;
        }

        .slide-nav-item.active {
            background: rgba(52, 152, 219, 0.3);
            border-left-color: #2980b9;
            font-weight: 600;
        }

        .slide-nav-item .slide-number {
            color: #3498db;
            font-weight: bold;
            margin-right: 10px;
        }

        .slide-nav-item .slide-title {
            color: #2c3e50;
            font-size: 0.9rem;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            margin: 20px;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .slide-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .slide-title-main {
            font-size: 1.5rem;
            font-weight: 300;
        }

        .slide-counter {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .slide-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
        }

        .slide {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .slide.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .slide h2 {
            color: #34495e;
            font-size: 1.8rem;
            margin: 30px 0 15px 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .slide h3 {
            color: #2980b9;
            font-size: 1.3rem;
            margin: 25px 0 10px 0;
        }

        .slide p {
            line-height: 1.8;
            margin-bottom: 15px;
            color: #34495e;
            font-size: 1.1rem;
        }

        .slide ul {
            margin: 15px 0 15px 30px;
        }

        .slide li {
            margin: 8px 0;
            line-height: 1.6;
            color: #34495e;
        }

        .highlight-box {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .highlight-box h3 {
            color: white;
            margin-bottom: 10px;
        }

        .warning-box {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .success-box {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .table-showcase {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }

        .table-showcase h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .key-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .field-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .field-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .field-description {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .business-impact {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .business-impact h3 {
            color: white;
            margin-bottom: 10px;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .flow-item {
            background: white;
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 15px 20px;
            text-align: center;
            min-width: 120px;
        }

        .flow-arrow {
            font-size: 1.5rem;
            color: #3498db;
            font-weight: bold;
        }

        .pipeline-stage {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .nav-btn.primary {
            background: #3498db;
            color: white;
        }

        .nav-btn.secondary {
            background: #95a5a6;
            color: white;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-bar {
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            transition: width 0.3s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-top: 4px solid #3498db;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @media (max-width: 768px) {
            .presentation-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 200px;
                overflow-x: auto;
            }
            
            .slide-nav {
                display: flex;
                gap: 10px;
                padding-bottom: 10px;
            }
            
            .slide-nav-item {
                min-width: 200px;
                flex-shrink: 0;
            }
            
            .main-content {
                margin: 10px;
            }
            
            .slide-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="presentation-container">
        <div class="sidebar">
            <h2>📚 V2 Pipeline Flow</h2>
            <ul class="slide-nav" id="slideNav">
                <li class="slide-nav-item active" data-slide="0">
                    <span class="slide-number">01</span>
                    <span class="slide-title">Database Architecture Overview</span>
                </li>
                <li class="slide-nav-item" data-slide="1">
                    <span class="slide-number">02</span>
                    <span class="slide-title">Foundation: Sources & Config</span>
                </li>
                <li class="slide-nav-item" data-slide="2">
                    <span class="slide-number">03</span>
                    <span class="slide-title">V2 Pipeline Control</span>
                </li>
                <li class="slide-nav-item" data-slide="3">
                    <span class="slide-number">04</span>
                    <span class="slide-title">Stage 1-3: Data Extraction</span>
                </li>
                <li class="slide-nav-item" data-slide="4">
                    <span class="slide-number">05</span>
                    <span class="slide-title">Stage 4: Duplicate Detection</span>
                </li>
                <li class="slide-nav-item" data-slide="5">
                    <span class="slide-number">06</span>
                    <span class="slide-title">Stage 5-6: Analysis & Filter</span>
                </li>
                <li class="slide-nav-item" data-slide="6">
                    <span class="slide-number">07</span>
                    <span class="slide-title">Stage 7-8: Storage & Updates</span>
                </li>
                <li class="slide-nav-item" data-slide="7">
                    <span class="slide-number">08</span>
                    <span class="slide-title">Performance Views</span>
                </li>
                <li class="slide-nav-item" data-slide="8">
                    <span class="slide-number">09</span>
                    <span class="slide-title">Database Functions</span>
                </li>
                <li class="slide-nav-item" data-slide="9">
                    <span class="slide-number">10</span>
                    <span class="slide-title">Business Logic Functions</span>
                </li>
                <li class="slide-nav-item" data-slide="10">
                    <span class="slide-number">11</span>
                    <span class="slide-title">Client Management</span>
                </li>
                <li class="slide-nav-item" data-slide="11">
                    <span class="slide-number">12</span>
                    <span class="slide-title">Geographic Intelligence</span>
                </li>
                <li class="slide-nav-item" data-slide="12">
                    <span class="slide-number">13</span>
                    <span class="slide-title">V1 Legacy Tables</span>
                </li>
                <li class="slide-nav-item" data-slide="13">
                    <span class="slide-number">14</span>
                    <span class="slide-title">Complete Architecture Map</span>
                </li>
            </ul>
        </div>

        <div class="main-content">
            <div class="slide-header">
                <h1 class="slide-title-main" id="slideTitle">Meridian ESG Database - V2 Pipeline Flow</h1>
                <div class="slide-counter" id="slideCounter">1 / 14</div>
            </div>

            <div class="slide-content">
                <!-- Slide 1: Database Architecture Overview -->
                <div class="slide active" data-slide="0">
                    <h1>🗂️ Database Architecture Overview</h1>
                    <p>This guide walks you through every table in the Meridian platform <strong>following the V2 pipeline flow</strong>, explaining how data flows through each stage and how tables connect to create our funding intelligence system.</p>
                    
                    <div class="highlight-box">
                        <h3>🔄 V2 Pipeline Flow (8 Stages)</h3>
                        <p><strong>Source Config → Data Extraction → Duplicate Detection → Branching → Analysis/Filter → Storage/Updates → Performance Monitoring</strong></p>
                    </div>

                    <h2>Database Structure</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">30+</div>
                            <div class="stat-label">Core Tables</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">12</div>
                            <div class="stat-label">Views</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">15+</div>
                            <div class="stat-label">Functions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">8</div>
                            <div class="stat-label">Pipeline Stages</div>
                        </div>
                    </div>

                    <h2>🚀 V2 Pipeline Stages</h2>
                    <div class="pipeline-stage">Stage 1: Source Orchestrator - Configuration & Setup</div>
                    <div class="pipeline-stage">Stage 2: API Call - External Data Fetching</div>
                    <div class="pipeline-stage">Stage 3: Data Extraction - Parse & Standardize</div>
                    <div class="pipeline-stage">Stage 4: Early Duplicate Detection - Smart Routing</div>
                    <div class="pipeline-stage">Stage 5: Analysis Agent - AI Enhancement (NEW only)</div>
                    <div class="pipeline-stage">Stage 6: Filter Function - Quality Control (NEW only)</div>
                    <div class="pipeline-stage">Stage 7: Storage Agent - Database Insert (NEW only)</div>
                    <div class="pipeline-stage">Stage 8: Direct Update - Quick Updates (UPDATE only)</div>

                    <div class="business-impact">
                        <h3>📋 Navigation Guide</h3>
                        <p>Each slide follows the V2 pipeline flow, showing exactly how data moves from external APIs through processing stages into your final opportunity database. We'll trace every table, view, and function involved in the journey.</p>
                    </div>
                </div>

                <!-- Slide 2: Foundation Tables -->
                <div class="slide" data-slide="1">
                    <h1>🏗️ Foundation: Sources & Configuration</h1>
                    <p>Before any pipeline can run, we need foundation tables that define <strong>who provides funding</strong> and <strong>where we get the data</strong>.</p>

                    <h2>📋 Core Foundation Tables</h2>
                    
                    <div class="table-showcase">
                        <h4>funding_sources</h4>
                        <p><strong>Purpose:</strong> Registry of agencies/organizations that provide funding (DOE, EPA, etc.)</p>
                        <p><strong>How Data Flows In:</strong> Auto-created via fundingSourceManager.getOrCreate() during processing</p>
                        <p><strong>Pipeline Role:</strong> Referenced when storing opportunities to link funding provider</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">id</div>
                                <div class="field-description">UUID primary key</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">name</div>
                                <div class="field-description">Agency/organization name</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">agency_type</div>
                                <div class="field-description">federal, state, local, foundation, utility</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>api_sources</h4>
                        <p><strong>Purpose:</strong> Registry of external APIs that provide funding data</p>
                        <p><strong>How Data Flows In:</strong> Manually configured by administrators</p>
                        <p><strong>Pipeline Role:</strong> Defines what APIs to call and when</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">api_endpoint</div>
                                <div class="field-description">URL to fetch data from</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">update_frequency</div>
                                <div class="field-description">How often to fetch new data</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">active</div>
                                <div class="field-description">Enable/disable without deletion</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>api_source_configurations</h4>
                        <p><strong>Purpose:</strong> Detailed processing parameters for each API source</p>
                        <p><strong>How Data Flows In:</strong> Admin configuration for processing rules</p>
                        <p><strong>Pipeline Role:</strong> Provides processing parameters to agents</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">config_type</div>
                                <div class="field-description">Type of configuration setting</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">configuration</div>
                                <div class="field-description">JSON configuration data</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>run_configuration</h4>
                        <p><strong>Purpose:</strong> Pipeline execution configuration flags</p>
                        <p><strong>How Data Flows In:</strong> Set when pipeline run starts</p>
                        <p><strong>Pipeline Role:</strong> Controls optimization features</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">optimization_enabled</div>
                                <div class="field-description">Enable V2 optimizations</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">early_duplicate_detection</div>
                                <div class="field-description">Enable smart routing</div>
                            </div>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <h3>🔗 Key Relationships</h3>
                        <p><strong>api_sources</strong> = WHERE data comes from (Grants.gov API)<br>
                        <strong>funding_sources</strong> = WHO provides the funding (Department of Energy)<br>
                        These foundation tables enable everything else in the pipeline.</p>
                    </div>
                </div>

                <!-- Slide 3: V2 Pipeline Control -->
                <div class="slide" data-slide="2">
                    <h1>⚡ V2 Pipeline Run Control</h1>
                    <p>These tables orchestrate and track the entire V2 pipeline execution, managing the 8-stage processing flow.</p>

                    <div class="flow-diagram">
                        <div class="flow-item">pipeline_runs<br>(Master)</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">pipeline_stages<br>(8 Stages)</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Performance<br>Metrics</div>
                    </div>

                    <div class="table-showcase">
                        <h4>pipeline_runs</h4>
                        <p><strong>Purpose:</strong> Master record for each V2 pipeline execution</p>
                        <p><strong>Created:</strong> When RunManagerV2.startRun() initiates processing</p>
                        <p><strong>Pipeline Role:</strong> Tracks overall execution and optimization metrics</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">id</div>
                                <div class="field-description">Unique run identifier</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">source_id</div>
                                <div class="field-description">Which API source being processed</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">status</div>
                                <div class="field-description">started, processing, completed, failed</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">total_tokens_used</div>
                                <div class="field-description">AI tokens consumed (currently broken)</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">opportunities_bypassed_llm</div>
                                <div class="field-description">Count bypassing expensive AI</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">final_results</div>
                                <div class="field-description">JSONB with complete stage results</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>pipeline_stages</h4>
                        <p><strong>Purpose:</strong> Tracks each of the 8 pipeline stages individually</p>
                        <p><strong>Created:</strong> As each stage begins processing</p>
                        <p><strong>Pipeline Role:</strong> Detailed stage-level execution tracking</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">stage_name</div>
                                <div class="field-description">source_orchestrator, data_extraction, etc.</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">status</div>
                                <div class="field-description">pending, processing, completed, failed, skipped</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">input_count</div>
                                <div class="field-description">Items entering stage (currently broken - always 0)</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">output_count</div>
                                <div class="field-description">Items leaving stage (currently broken - always 0)</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">stage_results</div>
                                <div class="field-description">JSONB with stage-specific output data</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">performance_metrics</div>
                                <div class="field-description">JSONB with execution metrics</div>
                            </div>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <h3>🎯 The 8 V2 Pipeline Stages</h3>
                        <ol>
                            <li><strong>source_orchestrator</strong> - Analyzes source configuration</li>
                            <li><strong>data_extraction</strong> - Fetches from external API</li>
                            <li><strong>early_duplicate_detector</strong> - Smart routing decision</li>
                            <li><strong>analysis</strong> - AI enhancement (NEW only)</li>
                            <li><strong>filter</strong> - Quality control (NEW only)</li>
                            <li><strong>storage</strong> - Database insert (NEW only)</li>
                            <li><strong>direct_update</strong> - Quick updates (UPDATE only)</li>
                            <li><strong>skip</strong> - No processing (SKIP path)</li>
                        </ol>
                    </div>

                    <div class="warning-box">
                        <h3>⚠️ Known Issues</h3>
                        <p>• input_count and output_count fields are not populated (always 0)<br>
                        • Token tracking is not implemented (total_tokens_used always 0)<br>
                        • Performance metrics are based on estimates, not measurements</p>
                    </div>
                </div>

                <!-- Slide 4: Stage 1-3 Data Extraction -->
                <div class="slide" data-slide="3">
                    <h1>📡 Stages 1-3: Data Extraction & Raw Storage</h1>
                    <p>The pipeline begins by fetching and storing raw data from external APIs.</p>

                    <div class="pipeline-stage">Stage 1: Source Orchestrator - Analyzes API configuration</div>
                    <div class="pipeline-stage">Stage 2: API Call - Fetches data from external source</div>
                    <div class="pipeline-stage">Stage 3: Data Extraction - Parses and standardizes</div>

                    <div class="table-showcase">
                        <h4>api_raw_responses</h4>
                        <p><strong>Purpose:</strong> Archive of raw API responses for auditing and reprocessing</p>
                        <p><strong>Created:</strong> Stage 2 when API call returns data</p>
                        <p><strong>Pipeline Role:</strong> Preserves original data, enables deduplication</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">id</div>
                                <div class="field-description">Response identifier</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">api_source_id</div>
                                <div class="field-description">Which API this came from</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">content</div>
                                <div class="field-description">JSONB raw API response (can be 10MB+)</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">content_hash</div>
                                <div class="field-description">SHA-256 for deduplication</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">opportunity_count</div>
                                <div class="field-description">Quick count without parsing</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">call_type</div>
                                <div class="field-description">list or detail API call</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>api_activity_logs</h4>
                        <p><strong>Purpose:</strong> Audit trail of all API interactions</p>
                        <p><strong>Created:</strong> Throughout stages 1-3 for tracking</p>
                        <p><strong>Pipeline Role:</strong> Debugging and monitoring</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">source_id</div>
                                <div class="field-description">API source reference</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">action</div>
                                <div class="field-description">fetch_started, fetch_completed, error</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">details</div>
                                <div class="field-description">JSONB with activity metadata</div>
                            </div>
                        </div>
                    </div>

                    <div class="flow-diagram">
                        <div class="flow-item">API Endpoint</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Raw Response</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">api_raw_responses</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Extracted Opportunities</div>
                    </div>

                    <div class="warning-box">
                        <h3>⚠️ Known Issue: Broken Linkage</h3>
                        <p>92.59% of opportunities have raw_response_id but only 7 of 31 raw responses are actually linked. 24 orphaned raw responses exist not connected to any opportunities.</p>
                    </div>

                    <div class="highlight-box">
                        <h3>💡 Stage 3 Output</h3>
                        <p>Data Extraction produces an array of standardized opportunity objects ready for duplicate detection. No AI processing yet - just data parsing and formatting.</p>
                    </div>
                </div>

                <!-- Slide 5: Stage 4 Early Duplicate Detection -->
                <div class="slide" data-slide="4">
                    <h1>🔍 Stage 4: Early Duplicate Detection</h1>
                    <p>The <strong>most critical V2 optimization stage</strong> - determines which path each opportunity takes through the pipeline.</p>

                    <div class="pipeline-stage">Stage 4: Early Duplicate Detector - Smart Routing Decision Point</div>

                    <div class="flow-diagram">
                        <div class="flow-item">150 Opportunities<br>from Extraction</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item" style="background: #27ae60;">50 NEW<br>(Full Pipeline)</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item" style="background: #f39c12;">30 UPDATE<br>(Direct Update)</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item" style="background: #95a5a6;">70 SKIP<br>(No Processing)</div>
                    </div>

                    <div class="table-showcase">
                        <h4>duplicate_detection_sessions</h4>
                        <p><strong>Purpose:</strong> Tracks duplicate detection results and optimization metrics</p>
                        <p><strong>Created:</strong> Stage 4 during duplicate analysis</p>
                        <p><strong>Pipeline Role:</strong> Records routing decisions and efficiency gains</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">run_id</div>
                                <div class="field-description">Links to pipeline_runs</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">new_opportunities</div>
                                <div class="field-description">Count going to full pipeline</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">opportunities_to_update</div>
                                <div class="field-description">Count for direct update</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">opportunities_to_skip</div>
                                <div class="field-description">Count skipping all processing</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">estimated_tokens_saved</div>
                                <div class="field-description">Hardcoded estimate (not real)</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>opportunity_processing_paths</h4>
                        <p><strong>Purpose:</strong> Audit trail of each opportunity's journey through pipeline</p>
                        <p><strong>Created:</strong> Stage 4 for each opportunity processed</p>
                        <p><strong>Pipeline Role:</strong> Tracks which path was taken and why</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">opportunity_identifier</div>
                                <div class="field-description">API opportunity ID</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">path_type</div>
                                <div class="field-description">NEW, UPDATE, or SKIP</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">path_reason</div>
                                <div class="field-description">no_duplicate_found, deadline_changed, etc.</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">stages_processed</div>
                                <div class="field-description">Array of stages this opportunity went through</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">final_outcome</div>
                                <div class="field-description">stored, updated, skipped, failed</div>
                            </div>
                        </div>
                    </div>

                    <div class="success-box">
                        <h3>✅ V2 Optimization Magic</h3>
                        <p>In this example: 100 of 150 opportunities (66%) bypass expensive AI processing!<br>
                        • 30 get quick database updates<br>
                        • 70 skip processing entirely<br>
                        • Only 50 need full AI analysis</p>
                    </div>

                    <div class="warning-box">
                        <h3>⚠️ Critical Issue</h3>
                        <p>Token savings calculations use hardcoded 1500 tokens/opportunity estimate. No actual measurement exists - all efficiency claims are theoretical!</p>
                    </div>
                </div>

                <!-- Slide 6: Stage 5-6 Analysis & Filter -->
                <div class="slide" data-slide="5">
                    <h1>🧠 Stages 5-6: Analysis & Filtering</h1>
                    <p>Only NEW opportunities (33% of total) proceed through these expensive AI processing stages.</p>

                    <div class="pipeline-stage">Stage 5: Analysis Agent - AI Enhancement (NEW only)</div>
                    <div class="pipeline-stage">Stage 6: Filter Function - Quality Control (NEW only)</div>

                    <div class="flow-diagram">
                        <div class="flow-item">50 NEW<br>Opportunities</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Analysis Agent<br>(AI Processing)</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">48 Enhanced</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Filter Function</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">48 Passed<br>(100% pass rate!)</div>
                    </div>

                    <div class="table-showcase">
                        <h4>agent_executions</h4>
                        <p><strong>Purpose:</strong> Tracks AI agent performance and costs</p>
                        <p><strong>Created:</strong> Stage 5 when Analysis Agent runs</p>
                        <p><strong>Pipeline Role:</strong> Should track token usage (but doesn't)</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">agent_type</div>
                                <div class="field-description">analysis_v2_parallel</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">execution_time_ms</div>
                                <div class="field-description">Time taken for AI processing</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">tokens_used</div>
                                <div class="field-description">Should track tokens (always 0/null)</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">cost_estimate</div>
                                <div class="field-description">Should track cost (always 0)</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>Stage 5 Analysis Results (in stage_results)</h4>
                        <p><strong>What Happens:</strong> AI enhances opportunities with scoring and categorization</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">enhanced_description</div>
                                <div class="field-description">AI-improved description</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">client_relevance</div>
                                <div class="field-description">Score 0-3</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">project_relevance</div>
                                <div class="field-description">Score 0-3</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">funding_attractiveness</div>
                                <div class="field-description">Score 0-3</div>
                            </div>
                        </div>
                    </div>

                    <div class="warning-box">
                        <h3>⚠️ Major Issues Found</h3>
                        <p><strong>Analysis Agent:</strong> Token tracking TODO never implemented - line 153 has explicit comment<br>
                        <strong>Filter Function:</strong> 100% pass rate - filter criteria too permissive to be useful</p>
                    </div>

                    <div class="highlight-box">
                        <h3>💡 Stage 6 Filter Reality</h3>
                        <p>Filter uses "exclude if 2+ categories are 0" rule - so permissive it never triggers. Opportunities with scores as low as (1,1,1) pass. Stage adds processing overhead with zero value.</p>
                    </div>
                </div>

                <!-- Slide 7: Stage 7-8 Storage & Updates -->
                <div class="slide" data-slide="6">
                    <h1>💾 Stages 7-8: Storage & Direct Updates</h1>
                    <p>The pipeline branches - NEW opportunities get stored, UPDATE opportunities get quick database updates.</p>

                    <div class="pipeline-stage">Stage 7: Storage Agent - Insert NEW opportunities</div>
                    <div class="pipeline-stage">Stage 8: Direct Update Handler - Update existing opportunities</div>

                    <div class="table-showcase">
                        <h4>funding_opportunities</h4>
                        <p><strong>Purpose:</strong> Master table for all funding opportunities</p>
                        <p><strong>Updated:</strong> Stage 7 (inserts) and Stage 8 (updates)</p>
                        <p><strong>Pipeline Role:</strong> Final destination for all processed data</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">id</div>
                                <div class="field-description">UUID primary key</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">api_source_id</div>
                                <div class="field-description">Links to api_sources</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">funding_source_id</div>
                                <div class="field-description">Links to funding_sources</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">raw_response_id</div>
                                <div class="field-description">Links to api_raw_responses</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">title</div>
                                <div class="field-description">Opportunity title</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">enhanced_description</div>
                                <div class="field-description">AI-enhanced description</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">scoring</div>
                                <div class="field-description">JSONB with relevance scores</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>funding_opportunity_eligibility</h4>
                        <p><strong>Purpose:</strong> Geographic eligibility for opportunities</p>
                        <p><strong>Created:</strong> Stage 7 after opportunity insert</p>
                        <p><strong>Pipeline Role:</strong> Enables location-based filtering</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">opportunity_id</div>
                                <div class="field-description">Links to funding_opportunities</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">state_id</div>
                                <div class="field-description">Links to states table</div>
                            </div>
                        </div>
                    </div>

                    <div class="flow-diagram">
                        <div class="flow-item" style="background: #27ae60;">48 NEW<br>from Filter</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Storage Agent<br>INSERT</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">42 Stored</div>
                    </div>

                    <div class="flow-diagram">
                        <div class="flow-item" style="background: #f39c12;">30 UPDATE<br>from Detection</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Direct Update<br>UPDATE</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">28 Updated</div>
                    </div>

                    <div class="success-box">
                        <h3>✅ Final Results</h3>
                        <p>From 150 opportunities:<br>
                        • 42 NEW stored (28%)<br>
                        • 28 UPDATE applied (19%)<br>
                        • 70 SKIP unchanged (47%)<br>
                        • 10 failures (6%)</p>
                    </div>

                    <div class="warning-box">
                        <h3>⚠️ Storage Agent Issue</h3>
                        <p>No conflict resolution - direct INSERT without ON CONFLICT handling. Relies entirely on upstream duplicate detection being perfect.</p>
                    </div>
                </div>

                <!-- Slide 8: Performance Views -->
                <div class="slide" data-slide="7">
                    <h1>📊 Performance Views & Monitoring</h1>
                    <p>Database views that aggregate pipeline data for monitoring and analytics.</p>

                    <div class="table-showcase">
                        <h4>detailed_api_runs</h4>
                        <p><strong>Purpose:</strong> Comprehensive run information with source details</p>
                        <p><strong>Data Source:</strong> Joins api_source_runs + api_sources</p>
                        <p><strong>Key Metrics:</strong> Execution time, opportunities processed, error details</p>
                    </div>

                    <div class="table-showcase">
                        <h4>api_source_run_stats</h4>
                        <p><strong>Purpose:</strong> Aggregated statistics per API source</p>
                        <p><strong>Data Source:</strong> Aggregates api_source_runs grouped by source</p>
                        <p><strong>Key Metrics:</strong> Success rates, average processing time, total opportunities</p>
                    </div>

                    <div class="table-showcase">
                        <h4>daily_run_statistics</h4>
                        <p><strong>Purpose:</strong> Time-series analytics for trend analysis</p>
                        <p><strong>Data Source:</strong> Aggregates runs by day</p>
                        <p><strong>Key Metrics:</strong> Daily volumes, success rates, performance trends</p>
                    </div>

                    <div class="table-showcase">
                        <h4>pipeline_stage_performance</h4>
                        <p><strong>Purpose:</strong> Stage-level performance metrics</p>
                        <p><strong>Data Source:</strong> Aggregates pipeline_stages data</p>
                        <p><strong>Key Metrics:</strong> Stage execution times, throughput, bottleneck identification</p>
                    </div>

                    <div class="table-showcase">
                        <h4>process_run_status</h4>
                        <p><strong>Purpose:</strong> System health monitoring</p>
                        <p><strong>Data Source:</strong> process_runs table status tracking</p>
                        <p><strong>Key Metrics:</strong> Active runs, failure patterns, stuck processes</p>
                    </div>

                    <div class="highlight-box">
                        <h3>💡 Rich Data, Poor Display</h3>
                        <p>pipeline_runs.final_results contains "Netflix-level analytics" but UI only shows raw JSON. Sophisticated metrics are captured but not visualized.</p>
                    </div>
                </div>

                <!-- Slide 9: Database Functions - Performance -->
                <div class="slide" data-slide="8">
                    <h1>⚙️ Database Functions - Performance Calculations</h1>
                    <p>PostgreSQL functions that calculate performance metrics and efficiency scores.</p>

                    <div class="table-showcase">
                        <h4>calculate_pipeline_metrics()</h4>
                        <p><strong>Purpose:</strong> Calculates overall pipeline efficiency metrics</p>
                        <p><strong>Parameters:</strong> run_id</p>
                        <p><strong>Returns:</strong> Efficiency score, token savings, time improvements</p>
                        <div class="warning-box">
                            <h3>⚠️ Issue</h3>
                            <p>Uses GREATEST(input_count, output_count, 1) but counts are always 0, so defaults to 1</p>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>calculate_pipeline_stage_metrics()</h4>
                        <p><strong>Purpose:</strong> Calculates per-stage performance metrics</p>
                        <p><strong>Parameters:</strong> stage_id</p>
                        <p><strong>Returns:</strong> Throughput, processing rate, resource usage</p>
                    </div>

                    <div class="table-showcase">
                        <h4>calculate_opportunity_processing_metrics()</h4>
                        <p><strong>Purpose:</strong> Tracks opportunity path efficiency</p>
                        <p><strong>Parameters:</strong> opportunity_id</p>
                        <p><strong>Returns:</strong> Processing time, stages traversed, outcome</p>
                    </div>

                    <div class="table-showcase">
                        <h4>calculate_duplicate_detection_effectiveness()</h4>
                        <p><strong>Purpose:</strong> Measures duplicate detection accuracy</p>
                        <p><strong>Parameters:</strong> session_id</p>
                        <p><strong>Returns:</strong> Detection rates, false positives, savings</p>
                    </div>

                    <div class="highlight-box">
                        <h3>📊 Performance Calculation Reality</h3>
                        <p>Functions exist but rely on broken data:<br>
                        • input_count/output_count always 0<br>
                        • Token usage never tracked<br>
                        • Calculations use hardcoded estimates</p>
                    </div>
                </div>

                <!-- Slide 10: Business Logic Functions -->
                <div class="slide" data-slide="9">
                    <h1>🎯 Business Logic Functions</h1>
                    <p>PostgreSQL functions that power the application's business logic and data retrieval.</p>

                    <div class="table-showcase">
                        <h4>get_opportunities()</h4>
                        <p><strong>Purpose:</strong> Main function for retrieving filtered opportunities</p>
                        <p><strong>Parameters:</strong> Multiple filters (location, amount, category, etc.)</p>
                        <p><strong>Returns:</strong> Filtered opportunity records with scores</p>
                        <p><strong>Variants:</strong> get_opportunities_v2(), get_opportunities_dynamic_sort()</p>
                    </div>

                    <div class="table-showcase">
                        <h4>get_funding_by_state()</h4>
                        <p><strong>Purpose:</strong> Geographic opportunity aggregation</p>
                        <p><strong>Parameters:</strong> state_ids[], categories[]</p>
                        <p><strong>Returns:</strong> State-level funding summaries for map display</p>
                    </div>

                    <div class="table-showcase">
                        <h4>get_funding_by_category()</h4>
                        <p><strong>Purpose:</strong> Category-based funding analytics</p>
                        <p><strong>Parameters:</strong> category_ids[]</p>
                        <p><strong>Returns:</strong> Funding totals grouped by category</p>
                    </div>

                    <div class="table-showcase">
                        <h4>update_total_funding_available()</h4>
                        <p><strong>Purpose:</strong> Calculates total funding for opportunities</p>
                        <p><strong>Trigger:</strong> Runs on opportunity insert/update</p>
                        <p><strong>Logic:</strong> Handles various funding amount formats</p>
                    </div>

                    <div class="table-showcase">
                        <h4>update_statuses()</h4>
                        <p><strong>Purpose:</strong> Updates opportunity status based on deadlines</p>
                        <p><strong>Trigger:</strong> Scheduled job</p>
                        <p><strong>Logic:</strong> Marks opportunities as expired when deadline passes</p>
                    </div>

                    <div class="highlight-box">
                        <h3>💡 Function Evolution</h3>
                        <p>Multiple versions exist (v1, v2, v3) as the schema evolved. Some functions have 10+ migration files fixing various issues.</p>
                    </div>
                </div>

                <!-- Slide 11: Client Management -->
                <div class="slide" data-slide="10">
                    <h1>🤝 Client Management & Tracking</h1>
                    <p>Tables that manage client relationships and opportunity matching.</p>

                    <div class="table-showcase">
                        <h4>clients</h4>
                        <p><strong>Purpose:</strong> Client profiles and preferences</p>
                        <p><strong>Pipeline Role:</strong> End consumers of processed opportunities</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">organization_type</div>
                                <div class="field-description">nonprofit, municipality, business</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">focus_areas</div>
                                <div class="field-description">Client's interest areas</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">location</div>
                                <div class="field-description">For geographic matching</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>tracked_opportunities</h4>
                        <p><strong>Purpose:</strong> Which opportunities clients are pursuing</p>
                        <p><strong>Created:</strong> When clients mark interest</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">client_id</div>
                                <div class="field-description">Links to clients</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">opportunity_id</div>
                                <div class="field-description">Links to funding_opportunities</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">tracking_status</div>
                                <div class="field-description">interested, applying, submitted, awarded</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>client_project_categories</h4>
                        <p><strong>Purpose:</strong> Client's project categories for matching</p>
                        <p><strong>Used By:</strong> Matching algorithms</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">category_weights</div>
                                <div class="field-description">Importance of each category</div>
                            </div>
                        </div>
                    </div>

                    <div class="flow-diagram">
                        <div class="flow-item">Processed<br>Opportunities</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Matching<br>Algorithm</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Client<br>Recommendations</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Tracked<br>Opportunities</div>
                    </div>
                </div>

                <!-- Slide 12: Geographic Intelligence -->
                <div class="slide" data-slide="11">
                    <h1>🌍 Geographic Intelligence</h1>
                    <p>Location-based eligibility matching for precise opportunity filtering.</p>

                    <div class="table-showcase">
                        <h4>states</h4>
                        <p><strong>Purpose:</strong> State reference data</p>
                        <p><strong>Records:</strong> 50 US states + territories</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">abbreviation</div>
                                <div class="field-description">Two-letter state code</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">name</div>
                                <div class="field-description">Full state name</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>funding_opportunity_eligibility</h4>
                        <p><strong>Purpose:</strong> Links opportunities to eligible states</p>
                        <p><strong>Created:</strong> During opportunity storage</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">opportunity_id</div>
                                <div class="field-description">Links to funding_opportunities</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">state_id</div>
                                <div class="field-description">Links to states</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>funding_opportunities_with_geography (View)</h4>
                        <p><strong>Purpose:</strong> Pre-joined geographic data for fast queries</p>
                        <p><strong>Performance:</strong> 50ms vs 2 seconds - 40x faster</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">50</div>
                            <div class="stat-label">States</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">95%</div>
                            <div class="stat-label">Noise Reduction</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">40x</div>
                            <div class="stat-label">Query Speed</div>
                        </div>
                    </div>

                    <div class="highlight-box">
                        <h3>📍 Geographic Impact</h3>
                        <p>Instead of 1,000 opportunities nationwide, clients see 50 in their state - 95% noise reduction dramatically improves relevance.</p>
                    </div>
                </div>

                <!-- Slide 13: V1 Legacy Tables -->
                <div class="slide" data-slide="12">
                    <h1>🏚️ V1 Legacy Tables (Deprecating)</h1>
                    <p>Original pipeline tables being phased out in favor of V2 architecture.</p>

                    <div class="warning-box">
                        <h3>⚠️ Scheduled for Deprecation</h3>
                        <p>These tables remain for backward compatibility but will be removed once V2 migration is complete.</p>
                    </div>

                    <div class="table-showcase">
                        <h4>api_source_runs</h4>
                        <p><strong>Purpose:</strong> V1 run tracking with basic stage status</p>
                        <p><strong>Limitation:</strong> No optimization, every opportunity processed fully</p>
                        <div class="key-fields">
                            <div class="field-item">
                                <div class="field-name">source_manager_status</div>
                                <div class="field-description">Linear stage tracking</div>
                            </div>
                            <div class="field-item">
                                <div class="field-name">api_handler_status</div>
                                <div class="field-description">No branching logic</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-showcase">
                        <h4>process_runs</h4>
                        <p><strong>Purpose:</strong> V1 general process tracking</p>
                        <p><strong>Status:</strong> Still referenced by some views</p>
                    </div>

                    <div class="table-showcase">
                        <h4>runs</h4>
                        <p><strong>Purpose:</strong> Original run table</p>
                        <p><strong>Status:</strong> Superseded by pipeline_runs</p>
                    </div>

                    <div class="table-showcase">
                        <h4>pipeline_performance_baselines</h4>
                        <p><strong>Purpose:</strong> V1 baseline metrics for comparison</p>
                        <p><strong>Issue:</strong> Comparison metrics being removed per new philosophy</p>
                    </div>

                    <div class="table-showcase">
                        <h4>api_extracted_opportunities</h4>
                        <p><strong>Purpose:</strong> Intermediate extraction storage</p>
                        <p><strong>Status:</strong> DEPRECATED - V2 goes direct to funding_opportunities</p>
                    </div>

                    <div class="table-showcase">
                        <h4>funding_programs</h4>
                        <p><strong>Purpose:</strong> Program-level abstraction</p>
                        <p><strong>Status:</strong> DEPRECATED - Unnecessary complexity</p>
                    </div>

                    <div class="highlight-box">
                        <h3>🔄 V1 vs V2 Architecture</h3>
                        <p><strong>V1:</strong> Linear processing, no optimization<br>
                        <strong>V2:</strong> Smart branching, 60-80% efficiency gains (claimed)</p>
                    </div>
                </div>

                <!-- Slide 14: Complete Architecture Map -->
                <div class="slide" data-slide="13">
                    <h1>🗺️ Complete V2 Pipeline Architecture</h1>
                    <p>The complete data flow through all tables, views, and functions following the V2 pipeline.</p>

                    <h2>🔄 Complete V2 Data Flow</h2>
                    <div class="flow-diagram">
                        <div class="flow-item">External APIs</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">api_raw_responses</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Extraction</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Duplicate Detection</div>
                    </div>

                    <div class="flow-diagram">
                        <div class="flow-item" style="background: #27ae60;">NEW Path</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Analysis + Filter</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Storage</div>
                    </div>

                    <div class="flow-diagram">
                        <div class="flow-item" style="background: #f39c12;">UPDATE Path</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">Direct Update</div>
                    </div>

                    <div class="flow-diagram">
                        <div class="flow-item" style="background: #95a5a6;">SKIP Path</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-item">No Processing</div>
                    </div>

                    <h2>📊 Key Table Categories</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">Foundation</div>
                            <div class="stat-label">api_sources, funding_sources</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">Pipeline</div>
                            <div class="stat-label">pipeline_runs, pipeline_stages</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">Storage</div>
                            <div class="stat-label">funding_opportunities</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">Analytics</div>
                            <div class="stat-label">Views & Functions</div>
                        </div>
                    </div>

                    <div class="business-impact">
                        <h3>🏆 V2 Architecture Achievements</h3>
                        <ul>
                            <li><strong>Smart Routing:</strong> 66% bypass expensive processing</li>
                            <li><strong>Efficiency Claims:</strong> 60-80% improvements (unverified)</li>
                            <li><strong>Rich Analytics:</strong> Detailed metrics captured (not displayed)</li>
                            <li><strong>Modular Design:</strong> Clear stage separation</li>
                        </ul>
                    </div>

                    <div class="warning-box">
                        <h3>⚠️ Critical Issues to Address</h3>
                        <ul>
                            <li>Token tracking not implemented</li>
                            <li>Input/output counts always 0</li>
                            <li>Filter function useless (100% pass rate)</li>
                            <li>Performance claims based on estimates</li>
                            <li>Rich analytics data not visualized</li>
                        </ul>
                    </div>

                    <div class="success-box">
                        <h3>✅ You Now Understand</h3>
                        <p>• Every table in the V2 pipeline flow<br>
                        • How data moves through 8 stages<br>
                        • Where optimizations happen (and don't)<br>
                        • What needs fixing for accurate metrics</p>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="nav-btn secondary" id="prevBtn">← Previous</button>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <button class="nav-btn primary" id="nextBtn">Next →</button>
            </div>
        </div>
    </div>

    <script>
        const slides = document.querySelectorAll('.slide');
        const slideNavItems = document.querySelectorAll('.slide-nav-item');
        const slideTitle = document.getElementById('slideTitle');
        const slideCounter = document.getElementById('slideCounter');
        const progressFill = document.getElementById('progressFill');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        let currentSlide = 0;
        const totalSlides = slides.length;

        const slideTitles = [
            "Database Architecture Overview",
            "Foundation: Sources & Configuration",
            "V2 Pipeline Run Control", 
            "Stages 1-3: Data Extraction & Raw Storage",
            "Stage 4: Early Duplicate Detection",
            "Stages 5-6: Analysis & Filtering",
            "Stages 7-8: Storage & Direct Updates",
            "Performance Views & Monitoring",
            "Database Functions - Performance Calculations",
            "Business Logic Functions",
            "Client Management & Tracking",
            "Geographic Intelligence",
            "V1 Legacy Tables (Deprecating)",
            "Complete V2 Pipeline Architecture"
        ];

        function updateSlide(slideIndex) {
            // Hide all slides
            slides.forEach(slide => slide.classList.remove('active'));
            slideNavItems.forEach(item => item.classList.remove('active'));

            // Show current slide
            slides[slideIndex].classList.add('active');
            slideNavItems[slideIndex].classList.add('active');

            // Update header
            slideTitle.textContent = slideTitles[slideIndex];
            slideCounter.textContent = `${slideIndex + 1} / ${totalSlides}`;

            // Update progress bar
            const progress = ((slideIndex + 1) / totalSlides) * 100;
            progressFill.style.width = `${progress}%`;

            // Update navigation buttons
            prevBtn.disabled = slideIndex === 0;
            nextBtn.disabled = slideIndex === totalSlides - 1;

            currentSlide = slideIndex;
        }

        // Navigation event listeners
        prevBtn.addEventListener('click', () => {
            if (currentSlide > 0) {
                updateSlide(currentSlide - 1);
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentSlide < totalSlides - 1) {
                updateSlide(currentSlide + 1);
            }
        });

        // Sidebar navigation
        slideNavItems.forEach((item, index) => {
            item.addEventListener('click', () => {
                updateSlide(index);
            });
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' && currentSlide > 0) {
                updateSlide(currentSlide - 1);
            } else if (e.key === 'ArrowRight' && currentSlide < totalSlides - 1) {
                updateSlide(currentSlide + 1);
            }
        });

        // Initialize
        updateSlide(0);
    </script>
</body>
</html>