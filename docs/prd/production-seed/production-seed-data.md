# Production Database Seed Data

> **Status**: Draft - In Progress
> **Created**: 2026-01-03
> **Last Updated**: 2026-01-03

## Overview

This document tracks all data that needs to be seeded in the production database before the application can function properly. The goal is to populate production with essential reference data and manually-processed records that cannot be regenerated by running the API pipeline.

## Context

- **Migrations**: Schema migrations will auto-apply when pushing to production
- **API Pipeline**: Will repopulate funding opportunities from Grants.gov and California Grants Portal
- **Manual Data**: Utility programs processed via Claude Code staging pipeline need to be migrated

---

## Seed Data Categories

### 1. API Sources (`api_sources` table)

**Priority**: REQUIRED
**Records**: 2

These are the API configurations that power the automated funding opportunity pipeline.

| ID | Name | Type | Endpoint | Notes |
|----|------|------|----------|-------|
| `68000a0d-02f3-4bc8-93a5-53fcf2fb09b1` | California Grants Portal | state | `https://data.ca.gov/api/3/action/datastore_search` | Single-stage API with SQL filtering |
| `7767eedc-8a09-4058-8837-fc8df8e437cb` | Grants.gov | federal | `https://api.grants.gov/v1/api/search2` | Two-stage API (search + detail) |

**Exclusions**: Do NOT migrate test sources:
- `Staging Test API Source`
- `Test API Source for Job Queue` (2 duplicates)

---

### 2. Coverage Areas (`coverage_areas` table)

**Priority**: REQUIRED
**Records**: 3,396

Geographic entities used for opportunity eligibility filtering and map visualization.

| Kind | Count | Description |
|------|-------|-------------|
| county | 3,235 | All US counties with PostGIS polygons |
| utility | 104 | California utilities (service territories) |
| state | 56 | 50 states + DC + territories |
| national | 1 | "United States" for national programs |

**Schema**:
```sql
- id (uuid)
- name (text)
- kind (text)
- code (text)
- state_code (char(2))
- geom (geometry) -- PostGIS polygons
- metadata (jsonb)
- created_at, updated_at
```

---

### 3. States (`states` table)

**Priority**: OPTIONAL - Verify Usage
**Records**: 51

Legacy table with US states and regions. May be superseded by `coverage_areas` with `kind = 'state'`.

| Column | Description |
|--------|-------------|
| id | Integer PK |
| name | Full state name |
| code | 2-letter code |
| region | Geographic region (South, West, Northeast, etc.) |

**TODO**: Check if any application code references this table directly. If not, may be deprecated in favor of coverage_areas.

---

### 4. Funding Sources (`funding_sources` table)

**Priority**: PARTIAL SEED
**Records**: 3 required (utilities with completed manual staging)

Funding sources represent organizations that provide funding. Most are created dynamically by the API pipeline, but utility sources with manually-processed opportunities need to be seeded.

**Required Seeds**:

| ID | Name | Type |
|----|------|------|
| `132bb373-9824-444c-8e9f-b72c3f25bfb7` | Southern California Edison | Utility |
| `aa87de44-73ae-4871-b6e2-a7449bad65d6` | City of Anaheim Public Utilities Department | Utility |
| `04e18d5d-a1b5-426a-80ae-5c2af320f3a5` | Pacific Gas & Electric Company | Utility |

**Note**: The full table has 171 records, but most will be recreated when the API pipeline runs. Only utility sources with completed manual staging records are required.

---

### 5. Manual Staging Records (`manual_funding_opportunities_staging` table)

**Priority**: RECOMMENDED
**Records**: 17 completed

The manual staging pipeline processes utility programs that don't have APIs. Completed records should be migrated to preserve the work done.

**Current Status**:
| Status | Count |
|--------|-------|
| Complete (all phases) | 17 |
| Pending | 228 |
| Skipped | 1 |
| **Total** | 246 |

**Completed Records by Source**:
| Source | Completed |
|--------|-----------|
| Southern California Edison | 14 |
| City of Anaheim | 2 |
| PG&E | 1 |

**Decision**: Migrate the 17 completed records. Pending records (228) can be reprocessed later.

---

### 6. Funding Opportunities - Utility Programs (`funding_opportunities` table)

**Priority**: REQUIRED
**Records**: 17

These are the manually-processed utility opportunities that are now in the main funding_opportunities table.

| Source | Count | Programs |
|--------|-------|----------|
| Southern California Edison | 14 | Charge Ready, Express Solutions, GRID-MAP, etc. |
| City of Anaheim | 2 | Customized Energy Incentives, EV Fleet Charger |
| PG&E | 1 | Government and K-12 Energy Efficiency Program |

**Note**: These have `funding_source_id` pointing to utility funding_sources, not `api_source_id`.

---

### 7. Opportunity Coverage Areas (`opportunity_coverage_areas` table)

**Priority**: REQUIRED (for utility opportunities)
**Records**: TBD - Links for the 17 utility opportunities

Junction table linking opportunities to their eligible coverage areas.

**Current Stats**:
- Total links: 437
- Unique opportunities: 266
- Unique coverage areas: 90

**Seed**: Only migrate links for the 17 utility opportunities.

---

### 8. System Tables

| Table | Records | Action |
|-------|---------|--------|
| `spatial_ref_sys` | 8,500 | **NO ACTION** - Auto-populated by PostGIS extension |

> **Note**: The `system_config` table exists but is unused. It was originally designed for global Force Full Reprocessing (FFR) but the feature was refactored to use `api_sources.force_full_reprocessing` flags directly. The table is kept for potential future use (feature flags, maintenance mode, etc.) but requires no seeding.

---

## What NOT to Seed

These will be regenerated by running the API pipeline:

1. **API-sourced funding_opportunities** (249 records)
   - 154 from California Grants Portal
   - 94 from Grants.gov

2. **Dynamically-created funding_sources** (~168 records)
   - Federal agencies
   - State agencies
   - Created during API processing

3. **Test data**
   - Test API sources
   - Pipeline/processing run logs

---

## Seed Order (Dependencies)

Execute seeds in this order to respect foreign key constraints:

1. `coverage_areas` (no dependencies)
2. `states` (if needed, no dependencies)
3. `api_sources` (no dependencies)
4. `funding_sources` (utilities only)
5. `manual_funding_opportunities_staging` (depends on funding_sources)
6. `funding_opportunities` (depends on funding_sources)
7. `opportunity_coverage_areas` (depends on funding_opportunities, coverage_areas)

---

## Export Scripts

TODO: Generate SQL export scripts for each table.

```bash
# Example structure
scripts/seed/
├── 01-coverage-areas.sql
├── 02-states.sql
├── 03-api-sources.sql
├── 04-funding-sources-utilities.sql
├── 05-manual-staging-completed.sql
├── 06-funding-opportunities-utilities.sql
└── 07-opportunity-coverage-areas-utilities.sql
```

---

## Open Questions

- [ ] Is the `states` table still used by application code?
- [ ] Should we migrate all 246 staging records or just the 17 completed?
- [ ] Are there any other tables with manually-entered data?
- [ ] Do we need to preserve UUIDs or can they be regenerated?

---

## Changelog

| Date | Change |
|------|--------|
| 2026-01-03 | Initial analysis and documentation |
| 2026-01-03 | Clarified `system_config` is unused (FFR refactored to use api_sources flags) |
